# =============================================================================
# AIDN - Fail2ban Jail Configuration for Game Servers
# =============================================================================
# Copy to: /etc/fail2ban/jail.d/aidn-gameserver.conf
# Reload: sudo fail2ban-client reload
# =============================================================================

# -----------------------------------------------------------------------------
# Default Settings Override
# -----------------------------------------------------------------------------
[DEFAULT]
# Ban duration (1 hour default, increase for repeat offenders)
bantime = 3600

# Time window for counting failures
findtime = 600

# Number of failures before ban
maxretry = 5

# Ban action - use iptables multiport for efficiency
banaction = iptables-multiport
banaction_allports = iptables-allports

# Enable incremental banning (repeat offenders get longer bans)
bantime.increment = true
bantime.factor = 2
bantime.formula = ban.Time * (1<<(ban.Count if ban.Count<20 else 20)) * banFactor
bantime.maxtime = 604800

# -----------------------------------------------------------------------------
# SSH Protection (Enhanced)
# -----------------------------------------------------------------------------
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
findtime = 300

# Aggressive mode for SSH (catches more attack patterns)
[sshd-aggressive]
enabled = true
port = ssh
filter = sshd[mode=aggressive]
logpath = /var/log/auth.log
maxretry = 3
bantime = 7200

# -----------------------------------------------------------------------------
# Arma Reforger Server Protection
# -----------------------------------------------------------------------------
# Monitor game server logs for suspicious activity
[arma-reforger]
enabled = true
port = 2001,17777,19999
protocol = udp,tcp
filter = arma-reforger
logpath = /var/log/arma-reforger/*.log
          /opt/arma-reforger/logs/*.log
maxretry = 10
findtime = 60
bantime = 1800

# RCON brute force protection
[arma-rcon]
enabled = true
port = 19999
protocol = tcp
filter = arma-rcon
logpath = /var/log/arma-reforger/*.log
          /opt/arma-reforger/logs/*.log
maxretry = 3
findtime = 300
bantime = 86400

# -----------------------------------------------------------------------------
# UDP Flood Detection (connection rate limiting via logs)
# -----------------------------------------------------------------------------
[udp-flood]
enabled = true
port = 2001,17777
protocol = udp
filter = udp-flood
logpath = /var/log/kern.log
          /var/log/messages
maxretry = 100
findtime = 10
bantime = 3600
action = iptables-allports[name=udp-flood, protocol=all]

# -----------------------------------------------------------------------------
# Port Scan Detection
# -----------------------------------------------------------------------------
[portscan]
enabled = true
filter = portscan
logpath = /var/log/kern.log
          /var/log/messages
maxretry = 10
findtime = 60
bantime = 86400
action = iptables-allports[name=portscan, protocol=all]

# -----------------------------------------------------------------------------
# Nginx/Reverse Proxy Protection (if applicable)
# -----------------------------------------------------------------------------
[nginx-http-auth]
enabled = false
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3

[nginx-limit-req]
enabled = false
port = http,https
filter = nginx-limit-req
logpath = /var/log/nginx/error.log
maxretry = 5

[nginx-botsearch]
enabled = false
port = http,https
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
maxretry = 2

# -----------------------------------------------------------------------------
# Docker Container Logs (if using Docker logging driver)
# -----------------------------------------------------------------------------
[docker-arma]
enabled = false
port = 2001,17777,19999
protocol = udp,tcp
filter = arma-reforger
# For Docker JSON logs:
logpath = /var/lib/docker/containers/*/*-json.log
# Or use Docker syslog driver:
# logpath = /var/log/syslog
maxretry = 10
findtime = 60
bantime = 1800

# -----------------------------------------------------------------------------
# Recidive - Long-term repeat offender jail
# -----------------------------------------------------------------------------
[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
banaction = iptables-allports
bantime = 604800
findtime = 86400
maxretry = 3
